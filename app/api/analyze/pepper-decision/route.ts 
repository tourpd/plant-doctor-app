// app/api/analyze/pepper-decision/route.ts
import { NextResponse } from "next/server";

import {
  pepperEngineDecision,
  PepperDecisionInput,
} from "../../../../engines/pepper.engine";

export async function POST(req: Request) {
  try {
    const body = (await req.json()) as Partial<PepperDecisionInput>;

    const {
      suddenWilt,
      oneSideWilt,
      stemSlime,
      noRecovery,
      photoCount,
    } = body;

    // 1️⃣ 입력값 최소 검증
    if (
      !suddenWilt ||
      !oneSideWilt ||
      !stemSlime ||
      !noRecovery ||
      typeof photoCount !== "number"
    ) {
      return NextResponse.json(
        { ok: false, error: "질문 답변이 누락되었습니다." },
        { status: 400 }
      );
    }

    // 2️⃣ 시스템 판결 (AI ❌)
    const decision = pepperEngineDecision({
      suddenWilt,
      oneSideWilt,
      stemSlime,
      noRecovery,
      photoCount,
    });

    // 3️⃣ 결과 반환
    return NextResponse.json({
      ok: true,
      decision,
    });
  } catch (err) {
    console.error("pepper-decision 오류:", err);
    return NextResponse.json(
      { ok: false, error: "판결 처리 중 오류 발생" },
      { status: 500 }
    );
  }
}